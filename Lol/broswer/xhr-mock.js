(function(){
  (function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.XHRMock=e()})(this,function(){"use strict";function t(t){var e=t.status,r=t.reason,n=t.headers,o=t.body,s=new v;return e&&s.status(e),r&&s.reason(r),n&&s.headers(n),o&&s.body(o),s}function e(e,r,n){var o=function(t){var n=t.method(),o=t.url().toString();return n.toUpperCase()===e.toUpperCase()&&(r instanceof RegExp?(r.lastIndex=0,r.test(o)):o===r)};return function(e,r){if(o(e))return"object"==typeof n?t(n):n(e,r)}}function r(t,e){function r(){this.constructor=t}E(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function n(t,e,r,n){return new(r||(r=Promise))(function(o,s){function i(t){try{a(n.next(t))}catch(t){s(t)}}function h(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(i,h)}a((n=n.apply(t,e||[])).next())})}function o(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,s=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],s=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,i,h,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return h={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h}function s(t,e){return e={exports:{}},t(e,e.exports),e.exports}function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function h(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function a(t,e,r){if(t&&O.isObject(t)&&t instanceof h)return t;var n=new h;return n.parse(t,e,r),n}function u(t){return O.isString(t)&&(t=a(t)),t instanceof h?t.format():h.prototype.format.call(t)}function p(t){var e=new V;if(!t)return e;var r=R(t,!0);if(r.protocol&&(e.protocol=r.protocol.substr(0,r.protocol.length-1)),r.auth){var n=r.auth.split(":"),o=n[0],s=n[1];o&&s?(e.username=o,e.password=s):e.username=o}return r.hostname&&(e.host=r.hostname),r.port&&(e.port=parseInt(r.port,10)),r.pathname&&(e.path=r.pathname),r.query&&(e.query=r.query),r.hash&&(e.hash=r.hash),e}function c(t){var e={protocol:t.protocol,auth:t.username&&t.password?t.username+":"+t.password:t.username,hostname:t.host,port:"number"==typeof t.port?String(t.port):t.port,pathname:t.path,query:t.query,hash:t.hash};return T(e)}function l(t){return t&&void 0!==t.then}function f(t,e,r){for(var n=0;n<t.length;++n){var o=t[n](e,r);if(o){if(l(o))throw new Error("xhr-mock: A MockFunction returned a Promise<MockResponse> in sync mode.");return o}}throw new Error("xhr-mock: No handler returned a response.")}function d(t,e,r){return t.reduce(function(t,n){return t.then(function(t){return t?t:n(e,r)})},Promise.resolve(void 0)).then(function(t){if(!t)throw new Error("xhr-mock: No handler returned a response.");return t})}function y(t){return void 0!==t.then}function m(t){var e=t.header("content-length"),r=t.body(),n=!1,o=0;if(e){var s=parseInt(e,10);NaN!==s&&(n=!0,o=s)}return{lengthComputable:n,loaded:r&&r.length||0,total:o}}var v=function(){function t(){this._status=200,this._reason="OK",this._headers={},this._body=null}return t.prototype.status=function(t){return"undefined"!=typeof t?(this._status=t,this):this._status},t.prototype.reason=function(t){return"undefined"!=typeof t?(this._reason=t,this):this._reason},t.prototype.statusText=function(t){return console.warn("xhr-mock: MockResponse.statusText() has been deprecated. Use MockResponse.reason() instead."),"undefined"!=typeof t?this.reason(t):this.reason()},t.prototype.header=function(t,e){return"undefined"!=typeof e?(this._headers[t.toLowerCase()]=e,this):this._headers[t.toLowerCase()]||null},t.prototype.headers=function(t){if("object"==typeof t){for(var e in t)t.hasOwnProperty(e)&&this.header(e,t[e]);return this}return this._headers},t.prototype.body=function(t){return"undefined"!=typeof t?(this._body=t,this):this._body},t}(),E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},b=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},w="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},g=s(function(t,e){(function(r){function n(t){throw RangeError(k[t])}function o(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function s(t,e){var r=t.split("@"),n="";r.length>1&&(n=r[0]+"@",t=r[1]),t=t.replace(_,".");var s=t.split("."),i=o(s,e).join(".");return n+i}function i(t){for(var e,r,n=[],o=0,s=t.length;o<s;)e=t.charCodeAt(o++),e>=55296&&e<=56319&&o<s?(r=t.charCodeAt(o++),56320==(64512&r)?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),o--)):n.push(e);return n}function h(t){return o(t,function(t){var e="";return t>65535&&(t-=65536,e+=P(t>>>10&1023|55296),t=56320|1023&t),e+=P(t)}).join("")}function a(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:O}function u(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function p(t,e,r){var n=0;for(t=r?I(t/C):t>>1,t+=I(t/e);t>j*N>>1;n+=O)t=I(t/j);return I(n+(j+1)*t/(t+S))}function c(t){var e,r,o,s,i,u,c,l,f,d,y=[],m=t.length,v=0,E=T,b=R;for(r=t.lastIndexOf(A),r<0&&(r=0),o=0;o<r;++o)t.charCodeAt(o)>=128&&n("not-basic"),y.push(t.charCodeAt(o));for(s=r>0?r+1:0;s<m;){for(i=v,u=1,c=O;s>=m&&n("invalid-input"),l=a(t.charCodeAt(s++)),(l>=O||l>I((g-v)/u))&&n("overflow"),v+=l*u,f=c<=b?x:c>=b+N?N:c-b,!(l<f);c+=O)d=O-f,u>I(g/d)&&n("overflow"),u*=d;e=y.length+1,b=p(v-i,e,0==i),I(v/e)>g-E&&n("overflow"),E+=I(v/e),v%=e,y.splice(v++,0,E)}return h(y)}function l(t){var e,r,o,s,h,a,c,l,f,d,y,m,v,E,b,w=[];for(t=i(t),m=t.length,e=T,r=0,h=R,a=0;a<m;++a)y=t[a],y<128&&w.push(P(y));for(o=s=w.length,s&&w.push(A);o<m;){for(c=g,a=0;a<m;++a)y=t[a],y>=e&&y<c&&(c=y);for(v=o+1,c-e>I((g-r)/v)&&n("overflow"),r+=(c-e)*v,e=c,a=0;a<m;++a)if(y=t[a],y<e&&++r>g&&n("overflow"),y==e){for(l=r,f=O;d=f<=h?x:f>=h+N?N:f-h,!(l<d);f+=O)b=l-d,E=O-d,w.push(P(u(d+b%E,0))),l=I(b/E);w.push(P(u(l,0))),h=p(r,v,o==s),r=0,++o}++r,++e}return w.join("")}function f(t){return s(t,function(t){return D.test(t)?c(t.slice(4).toLowerCase()):t})}function d(t){return s(t,function(t){return q.test(t)?"xn--"+l(t):t})}var y=e&&!e.nodeType&&e,m=t&&!t.nodeType&&t,v="object"==typeof w&&w;v.global!==v&&v.window!==v&&v.self!==v||(r=v);var E,b,g=2147483647,O=36,x=1,N=26,S=38,C=700,R=72,T=128,A="-",D=/^xn--/,q=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,k={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},j=O-x,I=Math.floor,P=String.fromCharCode;if(E={version:"1.3.2",ucs2:{decode:i,encode:h},decode:c,encode:l,toASCII:d,toUnicode:f},y&&m)if(t.exports==y)m.exports=E;else for(b in E)E.hasOwnProperty(b)&&(y[b]=E[b]);else r.punycode=E})(w)}),O={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}},x=function(t,e,r,n){e=e||"&",r=r||"=";var o={};if("string"!=typeof t||0===t.length)return o;var s=/\+/g;t=t.split(e);var h=1e3;n&&"number"==typeof n.maxKeys&&(h=n.maxKeys);var a=t.length;h>0&&a>h&&(a=h);for(var u=0;u<a;++u){var p,c,l,f,d=t[u].replace(s,"%20"),y=d.indexOf(r);y>=0?(p=d.substr(0,y),c=d.substr(y+1)):(p=d,c=""),l=decodeURIComponent(p),f=decodeURIComponent(c),i(o,l)?Array.isArray(o[l])?o[l].push(f):o[l]=[o[l],f]:o[l]=f}return o},N=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},S=function(t,e,r,n){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map(function(n){var o=encodeURIComponent(N(n))+r;return Array.isArray(t[n])?t[n].map(function(t){return o+encodeURIComponent(N(t))}).join(e):o+encodeURIComponent(N(t[n]))}).join(e):n?encodeURIComponent(N(n))+r+encodeURIComponent(N(t)):""},C=s(function(t,e){e.decode=e.parse=x,e.encode=e.stringify=S}),R=(C.decode,C.parse,C.encode,C.stringify,a),T=u,A=/^([a-z0-9.+-]+:)/i,D=/:[0-9]*$/,q=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,_=["<",">",'"',"`"," ","\r","\n","\t"],k=["{","}","|","\\","^","`"].concat(_),j=["'"].concat(k),I=["%","/","?",";","#"].concat(j),P=["/","?","#"],U=255,H=/^[+a-z0-9A-Z_-]{0,63}$/,L=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,M={javascript:!0,"javascript:":!0},G={javascript:!0,"javascript:":!0},X={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};h.prototype.parse=function(t,e,r){if(!O.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),o=n!==-1&&n<t.indexOf("#")?"?":"#",s=t.split(o),i=/\\/g;s[0]=s[0].replace(i,"/"),t=s.join(o);var h=t;if(h=h.trim(),!r&&1===t.split("#").length){var a=q.exec(h);if(a)return this.path=h,this.href=h,this.pathname=a[1],a[2]?(this.search=a[2],e?this.query=C.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var u=A.exec(h);if(u){u=u[0];var p=u.toLowerCase();this.protocol=p,h=h.substr(u.length)}if(r||u||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var c="//"===h.substr(0,2);!c||u&&G[u]||(h=h.substr(2),this.slashes=!0)}if(!G[u]&&(c||u&&!X[u])){for(var l=-1,f=0;f<P.length;f++){var d=h.indexOf(P[f]);d!==-1&&(l===-1||d<l)&&(l=d)}var y,m;m=l===-1?h.lastIndexOf("@"):h.lastIndexOf("@",l),m!==-1&&(y=h.slice(0,m),h=h.slice(m+1),this.auth=decodeURIComponent(y)),l=-1;for(var f=0;f<I.length;f++){var d=h.indexOf(I[f]);d!==-1&&(l===-1||d<l)&&(l=d)}l===-1&&(l=h.length),this.host=h.slice(0,l),h=h.slice(l),this.parseHost(),this.hostname=this.hostname||"";var v="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!v)for(var E=this.hostname.split(/\./),f=0,b=E.length;f<b;f++){var w=E[f];if(w&&!w.match(H)){for(var x="",N=0,S=w.length;N<S;N++)x+=w.charCodeAt(N)>127?"x":w[N];if(!x.match(H)){var R=E.slice(0,f),T=E.slice(f+1),D=w.match(L);D&&(R.push(D[1]),T.unshift(D[2])),T.length&&(h="/"+T.join(".")+h),this.hostname=R.join(".");break}}}this.hostname.length>U?this.hostname="":this.hostname=this.hostname.toLowerCase(),v||(this.hostname=g.toASCII(this.hostname));var _=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+_,this.href+=this.host,v&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==h[0]&&(h="/"+h))}if(!M[p])for(var f=0,b=j.length;f<b;f++){var F=j[f];if(h.indexOf(F)!==-1){var V=encodeURIComponent(F);V===F&&(V=escape(F)),h=h.split(F).join(V)}}var B=h.indexOf("#");B!==-1&&(this.hash=h.substr(B),h=h.slice(0,B));var K=h.indexOf("?");if(K!==-1?(this.search=h.substr(K),this.query=h.substr(K+1),e&&(this.query=C.parse(this.query)),h=h.slice(0,K)):e&&(this.search="",this.query={}),h&&(this.pathname=h),X[p]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var _=this.pathname||"",$=this.search||"";this.path=_+$}return this.href=this.format(),this},h.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&O.isObject(this.query)&&Object.keys(this.query).length&&(s=C.stringify(this.query));var i=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||X[e])&&o!==!1?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),i&&"?"!==i.charAt(0)&&(i="?"+i),r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),i=i.replace("#","%23"),e+o+r+i+n},h.prototype.resolve=function(t){return this.resolveObject(a(t,!1,!0)).format()},h.prototype.resolveObject=function(t){if(O.isString(t)){var e=new h;e.parse(t,!1,!0),t=e}for(var r=new h,n=Object.keys(this),o=0;o<n.length;o++){var s=n[o];r[s]=this[s]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var i=Object.keys(t),a=0;a<i.length;a++){var u=i[a];"protocol"!==u&&(r[u]=t[u])}return X[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!X[t.protocol]){for(var p=Object.keys(t),c=0;c<p.length;c++){var l=p[c];r[l]=t[l]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||G[t.protocol])r.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var d=r.pathname||"",y=r.search||"";r.path=d+y}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),E=v||m||r.host&&t.pathname,b=E,w=r.pathname&&r.pathname.split("/")||[],f=t.pathname&&t.pathname.split("/")||[],g=r.protocol&&!X[r.protocol];if(g&&(r.hostname="",r.port=null,r.host&&(""===w[0]?w[0]=r.host:w.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),E=E&&(""===f[0]||""===w[0])),v)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,w=f;else if(f.length)w||(w=[]),w.pop(),w=w.concat(f),r.search=t.search,r.query=t.query;else if(!O.isNullOrUndefined(t.search)){if(g){r.hostname=r.host=w.shift();var x=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");x&&(r.auth=x.shift(),r.host=r.hostname=x.shift())}return r.search=t.search,r.query=t.query,O.isNull(r.pathname)&&O.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!w.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var N=w.slice(-1)[0],S=(r.host||t.host||w.length>1)&&("."===N||".."===N)||""===N,C=0,R=w.length;R>=0;R--)N=w[R],"."===N?w.splice(R,1):".."===N?(w.splice(R,1),C++):C&&(w.splice(R,1),C--);if(!E&&!b)for(;C--;C)w.unshift("..");!E||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),S&&"/"!==w.join("/").substr(-1)&&w.push("");var T=""===w[0]||w[0]&&"/"===w[0].charAt(0);if(g){r.hostname=r.host=T?"":w.length?w.shift():"";var x=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");x&&(r.auth=x.shift(),r.host=r.hostname=x.shift())}return E=E||r.host&&w.length,E&&!T&&w.unshift(""),w.length?r.pathname=w.join("/"):(r.pathname=null,r.path=null),O.isNull(r.pathname)&&O.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},h.prototype.parseHost=function(){var t=this.host,e=D.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var F,V=function(){function t(){}return t.prototype.toString=function(){return c(this)},t}(),B=["CONNECT","TRACE","TRACK"],K=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],$=function(){function t(){this._method="GET",this._url=p(""),this._headers={},this._body=null}return t.prototype.method=function(t){if("undefined"!=typeof t){if(B.indexOf(t.toUpperCase())!==-1)throw new Error('xhr-mock: Method "'+t+'" is forbidden.');return K.indexOf(t.toUpperCase())!==-1?this._method=t.toUpperCase():this._method=t,this}return this._method},t.prototype.url=function(t){return"string"==typeof t?(this._url=p(t),this):this._url},t.prototype.header=function(t,e){return"undefined"!=typeof e?(this._headers[t.toLowerCase()]=e,this):this._headers[t.toLowerCase()]||null},t.prototype.headers=function(t){if("object"==typeof t){for(var e in t)t.hasOwnProperty(e)&&this.header(e,t[e]);return this}return this._headers},t.prototype.body=function(t){return"undefined"!=typeof t?(this._body=t,this):this._body},t}(),z=function(){function t(t,e){if(this.eventPhase=0,this.type=t||"",e){var r=e.scoped,n=void 0!==r&&r,o=e.bubbles,s=void 0!==o&&o,i=e.cancelable,h=void 0!==i&&i;this.scoped=n,this.bubbles=s,this.cancelable=h}}return t.prototype.initEvent=function(t,e,r){throw new Error},t.prototype.preventDefault=function(){throw new Error},t.prototype.stopImmediatePropagation=function(){throw new Error},t.prototype.stopPropagation=function(){throw new Error},t.prototype.deepPath=function(){throw new Error},t}(),Z=function(t){function e(e,r){var n=t.call(this,e,r)||this;if(r){var o=r.lengthComputable,s=void 0!==o&&o,i=r.loaded,h=void 0===i?0:i,a=r.total,u=void 0===a?0:a;n.lengthComputable=s,n.loaded=h,n.total=u}return n}return r(e,t),e.prototype.initProgressEvent=function(t,e,r,n,o,s){throw new Error},e}(z),J=function(){function t(){this.listeners={}}return t.prototype.addEventListener=function(t,e,r){this.listeners=this.listeners||{},e&&(this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].indexOf(e)===-1&&this.listeners[t].push(e))},t.prototype.removeEventListener=function(t,e,r){if(this.listeners=this.listeners||{},e&&this.listeners[t]){var n=this.listeners[t].indexOf(e);n!==-1&&this.listeners[t].splice(n,1)}},t.prototype.dispatchEvent=function(t){var e=this;this.listeners=this.listeners||{},t.target=this,t.currentTarget=this;var r=this["on"+t.type];return r&&r.call(this,t),!this.listeners[t.type]||(this.listeners[t.type].forEach(function(r){"function"==typeof r?r.call(e,t):r.handleEvent.call(e,t)}),!0)},t}(),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(J),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(Q),Y=new Error("xhr-mock: This feature hasn't been implmented yet. Please submit an Issue or Pull Request on Github."),tt=["CONNECT","TRACE","TRACK"];(function(t){t[t.UNSENT=0]="UNSENT",t[t.OPENED=1]="OPENED",t[t.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",t[t.LOADING=3]="LOADING",t[t.DONE=4]="DONE"})(F||(F={}));var et=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.UNSENT=F.UNSENT,r.OPENED=F.OPENED,r.HEADERS_RECEIVED=F.HEADERS_RECEIVED,r.LOADING=F.LOADING,r.DONE=F.DONE,r.withCredentials=!1,r.req=new $,r.res=new v,r.responseType="",r.responseURL="",r._timeout=0,r.upload=new W,r.readyState=e.UNSENT,r.isSynchronous=!1,r.isSending=!1,r.isUploadComplete=!1,r.isAborted=!1,r.isTimedOut=!1,r}return r(e,t),e.addHandler=function(t){this.handlers.push(t)},e.removeHandler=function(t){throw Y},e.removeAllHandlers=function(){this.handlers=[]},Object.defineProperty(e.prototype,"timeout",{get:function(){return this._timeout},set:function(t){if(0!==t&&this.isSynchronous)throw new Error("Timeouts cannot be set for synchronous requests made from a document.");this._timeout=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){if(""===this.responseType||"text"===this.responseType)return this.readyState!==this.LOADING&&this.readyState!==this.DONE?"":this.responseText;if(this.readyState!==this.DONE)return null;var t=this.res.body();if(!t)return null;if("json"===this.responseType&&"string"==typeof t)try{return JSON.parse(this.responseText)}catch(t){return null}if("blob"===this.responseType&&"string"==typeof t)try{throw Y}catch(t){return null}if("arraybuffer"===this.responseType&&"string"==typeof t)try{throw Y}catch(t){return null}if("document"===this.responseType&&"string"==typeof t)try{throw Y}catch(t){return null}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this.res.body()||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseXML",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.res.status()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this.res.reason()},enumerable:!0,configurable:!0}),e.prototype.getAllResponseHeaders=function(){var t=this.res.headers(),e=Object.keys(t).map(function(e){return e+": "+t[e]+"\r\n"}).join("");return e},e.prototype.getResponseHeader=function(t){return this.readyState<e.HEADERS_RECEIVED?null:this.res.header(t)},e.prototype.setRequestHeader=function(t,r){if(this.readyState<e.OPENED)throw new Error("xhr-mock: xhr must be OPENED.");this.req.header(t,r)},e.prototype.overrideMimeType=function(t){throw Y},e.prototype.open=function(t,r,n,o,s){if(void 0===n&&(n=!0),void 0===o&&(o=null),void 0===s&&(s=null),tt.indexOf(t)!==-1)throw new Error("xhr-mock: Method "+t+" is forbidden.");t=t.toUpperCase();var i=p(r);if(i.username=o||"",i.password=o&&s||"",!n&&(0!==this._timeout||""!==this.responseType))throw new Error("InvalidAccessError");if(this.isSending)throw new Error("xhr-mock: Unable to terminate the previous request");this.isSending=!1,this.isSynchronous=!n,this.req.method(t).headers({}).url(c(i)),this.applyNetworkError(),this.readyState!==this.OPENED&&(this.readyState=e.OPENED,this.dispatchEvent(new z("readystatechange")))},e.prototype.sendSync=function(){var t;try{if(t=f(e.handlers,this.req,this.res),y(t))throw new Error("xhr-mock: A handler returned a Promise<MockResponse> in sync mode.");this.handleResponseBody(t)}catch(t){e.errorCallback({req:this.req,err:t}),this.handleError(t)}},e.prototype.sendAsync=function(){return n(this,void 0,void 0,function(){var t,r,n,s,i,h=this;return o(this,function(o){switch(o.label){case 0:if(t=this.req,r=m(this.res),this.dispatchEvent(new Z("loadstart",b({},r,{loaded:0}))),this.isUploadComplete||(n=m(this.req),this.upload.dispatchEvent(new Z("loadstart",b({},n,{loaded:0})))),this.readyState!==this.OPENED||!this.isSending)return[2];0!==this._timeout&&(this._timeoutTimer=setTimeout(function(){h.isTimedOut=!0,h.handleError()},this._timeout)),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,d(e.handlers,this.req,this.res)];case 2:return s=o.sent(),clearTimeout(this._timeoutTimer),this.isAborted||this.isTimedOut?[2]:(this.sendRequest(t),this.receiveResponse(s),[3,4]);case 3:return i=o.sent(),clearTimeout(this._timeoutTimer),this.isAborted||this.isTimedOut?[2]:(e.errorCallback({req:this.req,err:i}),this.handleError(i),[3,4]);case 4:return[2]}})})},e.prototype.applyNetworkError=function(){this.res.status(0).reason("").headers({}).body(null)},e.prototype.reportError=function(t){if(this.readyState=this.DONE,this.isSending=!1,this.applyNetworkError(),this.isSynchronous)throw new Error("xhr-mock: An error occurred whilst sending a synchronous request.");if(this.dispatchEvent(new z("readystatechange")),!this.isUploadComplete){this.isUploadComplete=!0;var e=m(this.req);this.upload.dispatchEvent(new Z(t,e)),this.upload.dispatchEvent(new Z("loadend",e))}var r=m(this.res);this.dispatchEvent(new Z(t,r)),this.dispatchEvent(new Z("loadend",r))},e.prototype.sendRequest=function(t){if(!this.isUploadComplete){this.isUploadComplete=!0;var e=m(this.req);this.upload.dispatchEvent(new Z("progress",e)),this.upload.dispatchEvent(new Z("load",e)),this.upload.dispatchEvent(new Z("loadend",e))}},e.prototype.receiveResponse=function(t){return this.readyState=this.HEADERS_RECEIVED,this.dispatchEvent(new z("readystatechange")),null===t.body()?void this.handleResponseBody(t):(this.readyState=this.LOADING,this.dispatchEvent(new z("readystatechange")),void this.handleResponseBody(t))},e.prototype.handleError=function(t){if(this.isSending)return this.isTimedOut?void this.reportError("timeout"):this.isAborted?void this.reportError("abort"):void this.reportError("error")},e.prototype.handleResponseBody=function(t){this.res=t;var e=m(t);this.isSynchronous||this.dispatchEvent(new Z("progress",e)),this.readyState=this.DONE,this.isSending=!1,this.dispatchEvent(new z("readystatechange")),this.dispatchEvent(new Z("load",e)),this.dispatchEvent(new Z("loadend",e))},e.prototype.send=function(t){if(this.readyState!==e.OPENED)throw new Error("xhr-mock: Please call MockXMLHttpRequest.open() before MockXMLHttpRequest.send().");if(this.isSending)throw new Error("xhr-mock: MockXMLHttpRequest.send() has already been called.");"GET"!==this.req.method()&&"HEAD"!==this.req.method()||(t=null);var r,n;if(null!==t&&void 0!==t){if(t instanceof Document)r="UTF-8",n=t instanceof XMLDocument?"application/xml":"text/html";else if(t instanceof Blob)n=t.type;else if(t instanceof FormData)n="multipart/form-data; boundary=----XHRMockFormBoundary";else if(t instanceof URLSearchParams)r="UTF-8",n="application/x-www-form-urlencoded";else{if("string"!=typeof t)throw Y;r="UTF-8",n="text/plain"}var o=this.req.header("content-type");o||this.req.header("content-type",r?n+"; charset="+r:n),this.req.body(t)}this.isUploadComplete=!1,this.isTimedOut=!1,null!==t&&void 0!==t||(this.isUploadComplete=!0),this.isSending=!0,this.isSynchronous?this.sendSync():this.sendAsync()},e.prototype.abort=function(){if(clearTimeout(this._timeoutTimer),this.isAborted=!0,this.readyState!==this.OPENED&&this.readyState!==this.HEADERS_RECEIVED&&this.readyState!==this.LOADING||this.reportError("abort"),this.readyState===this.DONE)return this.readyState=this.UNSENT,void this.applyNetworkError()},e.prototype.msCachingEnabled=function(){return!1},e.UNSENT=F.UNSENT,e.OPENED=F.OPENED,e.HEADERS_RECEIVED=F.HEADERS_RECEIVED,e.LOADING=F.LOADING,e.DONE=F.DONE,e.handlers=[],e.errorCallback=function(t){var e=t.err;return console.error("xhr-mock: A handler errored: \n "+(e&&e.stack||e))},e}(Q),rt=window.XMLHttpRequest,nt=function(){function t(){this.RealXMLHttpRequest=rt}return t.prototype.setup=function(){return window.XMLHttpRequest=et,this.reset(),this},t.prototype.teardown=function(){return this.reset(),window.XMLHttpRequest=rt,this},t.prototype.reset=function(){return et.removeAllHandlers(),this},t.prototype.error=function(t){return et.errorCallback=t,this},t.prototype.mock=function(t,e,r){if(console.warn("xhr-mock: XHRMock.mock() has been deprecated. Use XHRMock.use() instead."),"string"==typeof t&&("string"==typeof e||e instanceof RegExp)&&void 0!==r)return this.use(t,e,r);if("function"==typeof t)return this.use(t);throw new Error("xhr-mock: Invalid handler.")},t.prototype.use=function(t,r,n){var o;if("string"==typeof t&&("string"==typeof r||r instanceof RegExp)&&void 0!==n)o=e(t,r,n);else{if("function"!=typeof t)throw new Error("xhr-mock: Invalid handler.");o=t}return et.addHandler(o),this},t.prototype.get=function(t,e){return this.use("GET",t,e)},t.prototype.post=function(t,e){return this.use("POST",t,e)},t.prototype.put=function(t,e){return this.use("PUT",t,e)},t.prototype.patch=function(t,e){return this.use("PATCH",t,e)},t.prototype.delete=function(t,e){return this.use("DELETE",t,e)},t}(),ot=new nt;return ot});

  const MockAPI = {
    addXhrMock: ({ mockURL, status, response, delay }) => {
      XHRMock.teardown();
      XHRMock.setup();

      const resFunction = (req, res) => {
        const body = response;
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            resolve(res.status(status).headers({'Content-Type': 'application/json'}).body(body));
          }, delay);
        })
      }
      XHRMock.get(mockURL, resFunction);
      XHRMock.post(mockURL, resFunction);
      XHRMock.put(mockURL, resFunction);
      XHRMock.patch(mockURL, resFunction);
      XHRMock.delete(mockURL, resFunction);
    }
  };

  addEventListener('message', (event => {
    if (event.data.id !== 'xhr-mock-api-message') return;
    MockAPI.addXhrMock(event.data);
  }), false);
})();
