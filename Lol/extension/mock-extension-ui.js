(()=>{"use strict";var e,t,n=function(){return(n=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};!function(e){e.MOCK="MOCK",e.DESTROY="DESTROY"}(e||(e={})),function(e){e.CHECK_STATE="CHECK_STATE",e.DESTROY_MOCK="DESTROY_MOCK"}(t||(t={}));var o={},a=!1,r=!1,s={classControl:function(e,t){t?null==e||e.classList.remove("label--warning"):null==e||e.classList.add("label--warning")},getInputValue:function(){var e,t,n,a;return{mockURL:null===(e=o.mockURL)||void 0===e?void 0:e.value.trim(),status:null===(t=o.status)||void 0===t?void 0:t.value.trim(),response:null===(n=o.response)||void 0===n?void 0:n.value.trim(),timeout:(null===(a=o.timeout)||void 0===a?void 0:a.value.trim())||"100-200"}},verify:function(){var e=s.getInputValue(),t=e.mockURL,n=e.status,o=e.response,a=e.timeout,r=!!t,c=!!n,l=!!o;try{JSON.parse(o||"")}catch(e){l=!1}return s.classControl(document.querySelector(".label-url"),r),s.classControl(document.querySelector(".label-status"),c),s.classControl(document.querySelector(".label-response"),l),{response:o,mockURL:t,timeout:a,status:n}},handleMockClick:function(){a=!0;var t=s.verify(),o=t.response,r=t.mockURL,c=t.timeout,l=t.status;if(r&&o&&l){try{JSON.parse(o)}catch(e){return void new Notification("Response 需要 JSON 字串",{icon:"../icon48.png"})}var u={response:o,mockURL:r,timeout:c,status:l};s.sendMessage(n(n({},u),{type:e.MOCK})),setTimeout(window.close,100)}else new Notification("請確認欄位是否設定完成",{icon:"../icon48.png"})},sendMessage:function(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){var n=t[0].id;void 0!==n&&chrome.tabs.sendMessage(n,e,(function(){chrome.runtime.lastError&&console.log("lastError:",chrome.runtime.lastError)}))}))},handleChange:function(){(function(e){localStorage.setItem("mockExtensionData",JSON.stringify(e))})(s.getInputValue()),a&&s.verify()},enabledState:function(e){if("interactive"===document.readyState||"complete"===document.readyState){var t=document.querySelector("#main"),n=document.querySelector("#enableSwitch");e?(t&&(t.style.display=""),n&&(n.checked=!0)):(t&&(t.style.display="none"),n&&(n.checked=!1))}},DOMContentLoaded:function(){if((o={mockURL:document.querySelector("#mockURL"),status:document.querySelector("#status"),response:document.querySelector("#response"),timeout:document.querySelector("#timeout")}).mockURL&&o.status&&o.response&&o.timeout){s.enabledState(r);var e={response:"",mockURL:"",timeout:"100-200",status:"200"};try{e=JSON.parse(localStorage.getItem("mockExtensionData")||"")||e}catch(e){localStorage.removeItem("mockExtensionData")}try{o.response.value=JSON.stringify(JSON.parse(e.response),null,2)}catch(t){o.response.value=e.response}o.mockURL.value=e.mockURL,o.timeout.value=e.timeout,o.status.value=e.status;for(var n=document.querySelectorAll("#btn"),a=0;a<n.length;a+=1)n[a].addEventListener("click",s.handleMockClick);var c=document.querySelector("#enableSwitch");null==c||c.addEventListener("change",(function(e){var n,o=e.target.checked;o!==r&&(n=r=o,chrome.storage.local.set({enable:n},(function(){console.log("Value is set to "+(n?"true":"false"))})),s.enabledState(r),o||s.sendMessage({type:t.DESTROY_MOCK}))})),Object.keys(o).forEach((function(e){var t,n;null===(t=o[e])||void 0===t||t.addEventListener("change",s.handleChange),null===(n=o[e])||void 0===n||n.addEventListener("keyup",s.handleChange)}))}}};chrome.storage.local.get(["enable"],(function(e){r="boolean"!=typeof e.enable||e.enable,s.enabledState(r)})),document.addEventListener("DOMContentLoaded",s.DOMContentLoaded)})();